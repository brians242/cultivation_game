<!---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultivation Path Mystery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background 2s ease;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            pointer-events: none;
            background: radial-gradient(circle at 50% 50%, currentColor 1px, transparent 1px);
            background-size: 50px 50px;
        }

        #game-container {
            max-width: 800px;
            width: 100%;
            border: 2px solid #fff;
            padding: 30px;
            background: rgba(0,0,0,0.8);
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }

        #video-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 20px;
            display: none;
        }

        #video {
            width: 1px;
            height: 1px;
            opacity: 0;
            position: absolute;
        }

        #color-display {
            width: 50px;
            height: 50px;
            border: 1px solid #fff;
            margin: 10px auto;
            display: none;
        }

        #story-text {
            min-height: 150px;
            margin: 20px 0;
            line-height: 1.6;
            font-size: 14px;
            white-space: pre-wrap;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            background: #000;
            color: #fff;
            border: 2px solid #fff;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        button:hover {
            background: #fff;
            color: #000;
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        #status {
            text-align: center;
            margin: 10px 0;
            font-size: 12px;
            opacity: 0.7;
        }

        .loading {
            text-align: center;
            margin: 20px 0;
        }

        #turn-counter {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }

        .talent-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .talent-card {
            border: 1px solid #fff;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: #000;
            position: relative;
        }

        .talent-card.gray { border-color: #666; }
        .talent-card.green { border-color: #0f0; }
        .talent-card.blue { border-color: #0af; }
        .talent-card.purple { border-color: #a0f; }
        .talent-card.gold { border-color: #fa0; box-shadow: 0 0 10px #fa0; }

        .talent-card:hover {
            background: #222;
            transform: scale(1.05);
        }

        .talent-card.selected {
            background: #333;
            border-width: 2px;
        }

        .talent-rarity {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
            opacity: 0.7;
        }

        .talent-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .talent-desc {
            font-size: 11px;
            line-height: 1.4;
        }

        #talent-confirm {
            width: 100%;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Background Music -->
    <div style="
        position: fixed;
        width: 1px;
        height: 1px;
        overflow: hidden;
        pointer-events: none;
        opacity: 0;
    ">
    <iframe
        src="https://www.youtube.com/embed/XmBji07OtwA?autoplay=1&loop=1&playlist=XmBji07OtwA&controls=0&mute=0"
        frameborder="0"
        allow="autoplay; encrypted-media">
    </iframe>
    </div>

    <div id="game-container">
        <h1>CULTIVATION PATH MYSTERY</h1>
        
        <div id="status">Initializing...</div>
        <div id="turn-counter"></div>
        
        <div id="video-container">
            <video id="video" autoplay playsinline></video>
        </div>
        
        <div id="color-display"></div>
        
        <div id="story-text">Welcome, seeker.

Your path through the cultivation realms awaits.
First, we must determine your spiritual essence...

Prepare yourself.</div>
        
        <div class="button-container" id="choices"></div>
    </div>

    <script>
        let gameState = {
            turn: 0,
            maxTurns: 0,
            path: null,
            dominantColor: null,
            colorHex: null,
            vibe: null,
            talents: [],
            selectedTalent: null,
            mysteryProgress: 0,
            started: false,
            gameOver: false,
            storyHistory: [] // avoid repetition
        };

        const video = document.getElementById('video');
        const colorDisplay = document.getElementById('color-display');
        const storyText = document.getElementById('story-text');
        const choicesContainer = document.getElementById('choices');
        const status = document.getElementById('status');
        const turnCounter = document.getElementById('turn-counter');

        const vibePaths = [
            { name: "Void Walker's Abyss", vibe: "dark", element: "Shadow", bg: "linear-gradient(135deg, #000000 0%, #1a0033 50%, #000000 100%)" },
            { name: "Celestial Phoenix Roost", vibe: "bright", element: "Radiance", bg: "linear-gradient(135deg, #330000 0%, #ff6600 50%, #ffcc00 100%)" },
            { name: "Ancient Dragon's Domain", vibe: "warm", element: "Primordial", bg: "linear-gradient(135deg, #1a0000 0%, #cc0000 50%, #330000 100%)" },
            { name: "Ethereal Spirit Realm", vibe: "cool", element: "Spirit", bg: "linear-gradient(135deg, #00001a 0%, #0066cc 50%, #00ccff 100%)" },
            { name: "Verdant Life Nexus", vibe: "green", element: "Nature", bg: "linear-gradient(135deg, #001a00 0%, #00cc44 50%, #003300 100%)" },
            { name: "Golden Emperor's Palace", vibe: "golden", element: "Imperial", bg: "linear-gradient(135deg, #332200 0%, #ffaa00 50%, #664400 100%)" },
            { name: "Twilight Boundary", vibe: "balanced", element: "Duality", bg: "linear-gradient(135deg, #1a001a 0%, #660066 50%, #330033 100%)" },
            { name: "Prismatic Chaos Plane", vibe: "chaotic", element: "Chaos", bg: "linear-gradient(135deg, #330011 0%, #663344 25%, #336666 50%, #664433 75%, #113333 100%)" }
        ];

        const allTalents = [
            // Gray (Common)
            { name: "Peasant's Endurance", desc: "Slightly increased stamina", rarity: "gray", curse: false, risk: 0 },
            { name: "Basic Cultivation", desc: "Normal cultivation speed", rarity: "gray", curse: false, risk: 0 },
            { name: "Observant Eyes", desc: "Notice small details", rarity: "gray", curse: false, risk: 0 },
            { name: "Strong Back", desc: "+5 carrying capacity", rarity: "gray", curse: false, risk: 0 },
            { name: "Night Vision", desc: "See better in darkness", rarity: "gray", curse: false, risk: 0 },
            { name: "Fast Reader", desc: "Learn techniques 10% faster", rarity: "gray", curse: false, risk: 0 },
            { name: "Steady Hands", desc: "Better control in crafting", rarity: "gray", curse: false, risk: 0 },
            { name: "Iron Stomach", desc: "Resist bad food", rarity: "gray", curse: false, risk: 0 },
            { name: "Quick Feet", desc: "Run 15% faster", rarity: "gray", curse: false, risk: 0 },
            { name: "Thick Skin", desc: "+3 physical defense", rarity: "gray", curse: false, risk: 0 },
            
            // Green (Uncommon)
            { name: "Elemental Affinity", desc: "Enhanced elemental cultivation", rarity: "green", curse: false, risk: 0 },
            { name: "Battle Instinct", desc: "+10 combat awareness", rarity: "green", curse: false, risk: 0 },
            { name: "Meditative Mind", desc: "Breakthrough 20% faster", rarity: "green", curse: false, risk: 0 },
            { name: "Beast Tamer", desc: "Bond with spirit beasts", rarity: "green", curse: false, risk: 0 },
            { name: "Herbalist Knowledge", desc: "Identify rare plants", rarity: "green", curse: false, risk: 0 },
            { name: "Qi Sensitivity", desc: "Sense qi fluctuations", rarity: "green", curse: false, risk: 0 },
            { name: "Formation Basics", desc: "Understand simple arrays", rarity: "green", curse: false, risk: 0 },
            { name: "Sword Talent", desc: "+15 sword comprehension", rarity: "green", curse: false, risk: 0 },
            { name: "Alchemy Novice", desc: "Refine basic pills", rarity: "green", curse: false, risk: 0 },
            { name: "Spiritual Roots", desc: "Absorb qi 25% faster", rarity: "green", curse: false, risk: 0 },
            
            // Blue (Rare)
            { name: "Dual Element Control", desc: "Cultivate two elements", rarity: "blue", curse: false, risk: 3 },
            { name: "Heavenly Insight", desc: "Comprehend laws easier", rarity: "blue", curse: false, risk: 0 },
            { name: "Phoenix Blood", desc: "Regenerate from injuries", rarity: "blue", curse: false, risk: 3 },
            { name: "Thunder Body", desc: "+20 speed, lightning resistant", rarity: "blue", curse: false, risk: 0 },
            { name: "Soul Perception", desc: "Read others' cultivation", rarity: "blue", curse: false, risk: 0 },
            { name: "Weapon Master", desc: "Master any weapon quickly", rarity: "blue", curse: false, risk: 0 },
            { name: "Pill Prodigy", desc: "+30% pill quality", rarity: "blue", curse: false, risk: 0 },
            { name: "Spatial Sense", desc: "Feel spatial distortions", rarity: "blue", curse: false, risk: 0 },
            { name: "Battle Sage", desc: "+25 combat intelligence", rarity: "blue", curse: false, risk: 0 },
            { name: "Spirit Contract", desc: "Form binding contracts", rarity: "blue", curse: false, risk: 0 },
            
            // Purple (Epic)
            { name: "Void Constitution", desc: "+40 power, void techniques", rarity: "purple", curse: false, risk: 0 },
            { name: "Celestial Eyes", desc: "See through all illusions", rarity: "purple", curse: false, risk: 0 },
            { name: "Reincarnator", desc: "Memories of past life", rarity: "purple", curse: false, risk: 0 },
            { name: "Time Perception", desc: "Slow time in combat", rarity: "purple", curse: false, risk: 0 },
            { name: "Immortal Physique", desc: "Age 90% slower", rarity: "purple", curse: false, risk: 0 },
            { name: "Dragon Heritage", desc: "+50 power, dragon techniques", rarity: "purple", curse: true, risk: 8 },
            { name: "Fate Reader", desc: "See glimpses of future", rarity: "purple", curse: false, risk: 0 },
            
            // Gold (Legendary)
            { name: "Supreme Spirit Root", desc: "Cultivation speed x3", rarity: "gold", curse: true, risk: 15 },
            { name: "Primordial Chaos Body", desc: "Infinite potential", rarity: "gold", curse: true, risk: 18 },
            { name: "Ancient Bloodline", desc: "Overwhelming power", rarity: "gold", curse: true, risk: 12 },
            { name: "Hidden Sage", desc: "+80 power, conceals your presence", rarity: "gold", curse: false, risk: 0 },
            { name: "Fortune's Favorite", desc: "Extreme luck, breakthroughs come naturally", rarity: "gold", curse: false, risk: 0 }
        ];

        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                video.srcObject = stream;
                document.getElementById('video-container').style.display = 'block';
                status.textContent = 'Analyzing your spiritual essence...';
                
                setTimeout(() => detectColor(), 2000);
            } catch (err) {
                status.textContent = 'Camera denied. Using neutral essence.';
                setTimeout(() => {
                    gameState.vibe = 'balanced';
                    gameState.dominantColor = 'gray';
                    showTalentSelection();
                }, 1000);
            }
        }

        function detectColor() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 320;
            canvas.height = video.videoHeight || 240;
            const ctx = canvas.getContext('2d');
            
            if (video.videoWidth > 0) {
                ctx.drawImage(video, 0, 0);
            }
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            let r = 0, g = 0, b = 0, count = 0, brightness = 0;
            
            for (let i = 0; i < data.length; i += 4 * 10) {
                r += data[i];
                g += data[i + 1];
                b += data[i + 2];
                brightness += (data[i] + data[i + 1] + data[i + 2]) / 3;
                count++;
            }
            
            r = Math.floor(r / count);
            g = Math.floor(g / count);
            b = Math.floor(b / count);
            brightness = Math.floor(brightness / count);
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const colorfulness = max - min;
            
            const colorHex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            colorDisplay.style.backgroundColor = colorHex;
            colorDisplay.style.display = 'block';
            
            // determine vibe
            let vibe = 'balanced';
            
            if (brightness < 50) vibe = 'dark';
            else if (brightness > 200) vibe = 'bright';
            else if (colorfulness < 30) vibe = 'balanced';
            else if (r > g && r > b && g > b) vibe = 'golden';
            else if (r > g + 30 && r > b + 30) vibe = 'warm';
            else if (b > r + 30 && b > g + 30) vibe = 'cool';
            else if (g > r + 20 && g > b + 20) vibe = 'green';
            else if (Math.abs(r - b) < 40 && r > g) vibe = 'chaotic';
            
            gameState.vibe = vibe;
            gameState.dominantColor = (r > g && r > b) ? 'red' : (g > b ? 'green' : 'blue');
            gameState.colorHex = colorHex;
            
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            document.getElementById('video-container').style.display = 'none';
            
            showTalentSelection();
        }

        function showTalentSelection() {
            gameState.path = vibePaths.find(p => p.vibe === gameState.vibe) || vibePaths[6];
            gameState.maxTurns = Math.floor(Math.random() * 100); // 0-99 rounds
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            if (gameState.maxTurns < 20) gameState.maxTurns = Math.floor(Math.random() * 100);
            // yes i know this is troll bro im tired ok yanderedev reference completely intentional


            document.body.style.background = gameState.path.bg;
            
            status.textContent = `Essence: ${gameState.path.element}`;
            storyText.textContent = `Your soul resonates with the ${gameState.path.name}.\n\nDestiny awaits across ${gameState.maxTurns} trials.\n\nSelect your innate talent:`;
            
            const shuffled = [...allTalents].sort(() => Math.random() - 0.5);
            gameState.talents = shuffled.slice(0, 10);
            
            choicesContainer.innerHTML = '<div class="talent-selection" id="talent-grid"></div>';
            const grid = document.getElementById('talent-grid');
            
            gameState.talents.forEach((talent, idx) => {
                const card = document.createElement('div');
                card.className = `talent-card ${talent.rarity}`;
                card.innerHTML = `
                    <div class="talent-rarity">${talent.rarity.toUpperCase()}</div>
                    <div class="talent-name">${talent.name}</div>
                    <div class="talent-desc">${talent.desc}</div>
                `;
                card.onclick = () => selectTalent(idx);
                grid.appendChild(card);
            });
            
            const confirmBtn = document.createElement('button');
            confirmBtn.id = 'talent-confirm';
            confirmBtn.textContent = '> Begin Journey';
            confirmBtn.disabled = true;
            confirmBtn.onclick = () => startGame();
            choicesContainer.appendChild(confirmBtn);
        }

        function selectTalent(idx) {
            document.querySelectorAll('.talent-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.talent-card')[idx].classList.add('selected');
            gameState.selectedTalent = gameState.talents[idx];
            document.getElementById('talent-confirm').disabled = false;
        }

        function startGame() {
            gameState.started = true;
            status.textContent = `${gameState.path.name} | ${gameState.selectedTalent.name}`;
            turnCounter.textContent = `Turn: ${gameState.turn}/${gameState.maxTurns}`;
            
            const initialRisk = (gameState.selectedTalent.risk || 0) / 100;
            if (gameState.selectedTalent.curse && Math.random() < initialRisk) {
                storyText.textContent = `DISASTER! Your ${gameState.selectedTalent.name} attracted a powerful enemy!\n\nThey sense your potential and strike immediately...\n\nGAME OVER - Talent Stolen`;
                choicesContainer.innerHTML = '';
                const restartBtn = document.createElement('button');
                restartBtn.textContent = '> Try Again (New Life)';
                restartBtn.onclick = () => location.reload();
                choicesContainer.appendChild(restartBtn);
                return;
            }
            
            storyText.textContent = `With ${gameState.selectedTalent.name} awakened, your path through ${gameState.path.name} begins...\n\nThe Emerald Truth calls to you.`;
            
            choicesContainer.innerHTML = '';
            setTimeout(() => nextTurn(), 2500);
        }

        async function nextTurn() {
            if (gameState.turn >= gameState.maxTurns) {
                endGame();
                return;
            }
            
            // this turns risk determination
            const turnRisk = (gameState.selectedTalent.risk || 0) / 150;
            if (gameState.selectedTalent.curse && Math.random() < turnRisk) {
                gameState.gameOver = true;
                storyText.textContent = `A hidden enemy sensed your ${gameState.selectedTalent.name}!\n\nThey ambush you and steal your talent!\n\nGAME OVER`;
                choicesContainer.innerHTML = '';
                const restartBtn = document.createElement('button');
                restartBtn.textContent = '> Reincarnate';
                restartBtn.onclick = () => location.reload();
                choicesContainer.appendChild(restartBtn);
                return;
            }
            
            gameState.turn++;
            turnCounter.textContent = `Turn: ${gameState.turn}/${gameState.maxTurns}`;
            
            status.textContent = 'Consulting the Dao...';
            choicesContainer.innerHTML = '<div class="loading">...</div>';
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'anthropic-version': '2023-06-01',
                        /* api key "x-api-key": process.env. */
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 800,
                        messages: [{
                            role: 'user',
                            content: `Generate a cultivation story turn. Turn ${gameState.turn}/${gameState.maxTurns}.

Path: ${gameState.path.name} (${gameState.path.element} element)
Talent: ${gameState.selectedTalent.name} (${gameState.selectedTalent.rarity} rarity)
${gameState.selectedTalent.curse ? 'NOTE: This talent has risk - enemies may notice it' : ''}

Previous story beats (DO NOT REPEAT THESE):
${gameState.storyHistory.slice(-3).join(' | ')}

Theme: The Emerald Truth - a jade/green cultivation mystery.

${gameState.turn >= gameState.maxTurns - 2 ? 'IMPORTANT: Near the end. Reveal the Emerald Truth mystery.' : ''}

Create something NEW and different from what came before.

Output ONLY JSON:
{
  "story": "2-3 sentence story fragment",
  "choice1": "10-15 word choice",
  "choice2": "10-15 word choice"
}`
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                let text = data.content?.find(c => c.type === 'text')?.text || '';
                text = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                
                const parsed = JSON.parse(text);
                
                typeText(storyText, parsed.story);
                gameState.storyHistory.push(parsed.story); // track story
                
                choicesContainer.innerHTML = '';
                const btn1 = document.createElement('button');
                btn1.textContent = `> ${parsed.choice1}`;
                btn1.onclick = () => makeChoice(1);
                
                const btn2 = document.createElement('button');
                btn2.textContent = `> ${parsed.choice2}`;
                btn2.onclick = () => makeChoice(2);
                
                choicesContainer.appendChild(btn1);
                choicesContainer.appendChild(btn2);
                
                status.textContent = `${gameState.path.name} | ${gameState.selectedTalent.name}`;
                
            } catch (err) {
                console.error('API Error:', err);
                
                // i give up bro pmo fr this wrapper business lwk hard no b2b saas for me
                let fallbacks = [];

                fetch('fallbacks.json')
                    .then(res => res.json())
                    .then(data => {
                        fallbacks = data;
                        console.log('Fallbacks loaded:', fallbacks.length);
                    })
                    .catch(err => {
                        console.error('Failed to load fallbacks.json', err);
                    });

                const f = fallbacks[Math.floor(Math.random() * fallbacks.length)];
                
                storyText.textContent = f.s;
                choicesContainer.innerHTML = '';
                
                const btn1 = document.createElement('button');
                btn1.textContent = `> ${f.c1}`;
                btn1.onclick = () => makeChoice(1);
                
                const btn2 = document.createElement('button');
                btn2.textContent = `> ${f.c2}`;
                btn2.onclick = () => makeChoice(2);
                
                choicesContainer.appendChild(btn1);
                choicesContainer.appendChild(btn2);
                
                status.textContent = `${gameState.path.name} (Offline)`;
            }
        }

        function makeChoice(num) {
            gameState.mysteryProgress += num;
            choicesContainer.innerHTML = '';
            setTimeout(() => nextTurn(), 1000);
        }

        function typeText(el, text, speed = 15) {
            el.textContent = "";
            let i = 0;
            const interval = setInterval(() => {
                el.textContent += text[i++];
                if (i >= text.length) clearInterval(interval);
            }, speed);
}


        function endGame() {
            // final check
            const finalRisk = (gameState.selectedTalent.risk || 0) / 100;
            if (gameState.selectedTalent.curse && Math.random() < finalRisk) {
                status.textContent = 'CATASTROPHE';
                storyText.textContent = `Just as enlightenment was within reach...\n\nA rival sensed your ${gameState.selectedTalent.name} at its peak power!\n\nIn a desperate final battle, they shattered your cultivation and stole your talent.\n\nYou die with empty meridians, your potential stolen.\n\n[TRAGIC END - TALENT STOLEN AT THE THRESHOLD]`;
                
                choicesContainer.innerHTML = '';
                const restartBtn = document.createElement('button');
                restartBtn.textContent = '> Reincarnate and Try Again';
                restartBtn.onclick = () => location.reload();
                choicesContainer.appendChild(restartBtn);
                return;
            }
            
            status.textContent = 'Journey Complete';
            
            // different endings
            const endings = {
                gray: [
                    `After ${gameState.maxTurns} trials, you understood a fragment of the Emerald Truth.\n\n"Jade grows slowly, but it endures."\n\nYou lived quietly in the ${gameState.path.name}, teaching peasant children basic cultivation. Your name fades from memory within a generation.\n\n[COMMON ENDING: Humble Teacher]`,
                    
                    `The journey ends with modest gains. You grasped the simplest truth:\n\n"Even common stones can hold beauty."\n\nYou became a low-rank outer disciple elder. Nothing remarkable, but you died peacefully at 120 years old.\n\n[COMMON ENDING: Quiet Life]`,
                    
                    `Your ${gameState.selectedTalent.name} carried you as far as it could.\n\n"The dao has no favorites - only persistence matters."\n\nYou never broke through to higher realms, but you mastered your basics perfectly. A footnote in the ${gameState.path.name} records.\n\n[COMMON ENDING: Perfected Foundation]`
                ],
                
                green: [
                    `After ${gameState.maxTurns} trials, the Emerald Truth became clear:\n\n"Growth comes to those who cultivate patience."\n\nYou became an Inner Sect Elder of the ${gameState.path.name}. Three of your disciples reached Core Formation. Your lineage continues for five generations.\n\n[UNCOMMON ENDING: Respected Elder]`,
                    
                    `Your ${gameState.selectedTalent.name} proved its worth. You understood:\n\n"Nature rewards those who flow with its rhythms."\n\nYou established a small branch sect. Your techniques are studied in regional academies. A statue stands in your honor.\n\n[UNCOMMON ENDING: Branch Founder]`,
                    
                    `The path was long but fruitful. The truth revealed itself:\n\n"Jade qi flows where intention guides it."\n\nYou authored three cultivation manuals that helped hundreds. The ${gameState.path.name} remembers you fondly.\n\n[UNCOMMON ENDING: Scholar of the Path]`
                ],
                
                blue: [
                    `After ${gameState.maxTurns} trials, you grasped the deeper Emerald Truth:\n\n"Connection is the root of all power."\n\nYou ascended to Grand Elder, mastered the Nascent Soul realm, and your name is spoken with reverence. Your disciples spread across three kingdoms.\n\n[RARE ENDING: Grand Elder]`,
                    
                    `Your ${gameState.selectedTalent.name} unlocked profound mysteries:\n\n"The dao speaks through jade to those who listen."\n\nYou became Patriarch of the ${gameState.path.name}. Enemy sects fear your name. Legends will speak of you for a thousand years.\n\n[RARE ENDING: Legendary Patriarch]`,
                    
                    `The Emerald Truth illuminated your path completely:\n\n"Heaven and Earth are one - jade is their bridge."\n\nYou reformed the ${gameState.path.name}'s techniques, doubling their power. Your breakthrough created a new cultivation method studied by all.\n\n[RARE ENDING: Revolutionary Master]`
                ],
                
                purple: [
                    `After ${gameState.maxTurns} trials, you TRANSCENDED mortal limits:\n\n"I am jade. I am earth. I am the eternal cycle."\n\nYou founded the Emerald Jade Sect, which rivals the ancient powers. Your name shakes the cultivation world. You achieved Dao Fusion realm.\n\n[EPIC ENDING: Sect Founder]`,
                    
                    `Your ${gameState.selectedTalent.name} carried you beyond mortal comprehension:\n\n"Death is an illusion. Rebirth is the only truth."\n\nYou shattered your mortal shell and reformed as a Jade Spirit. The ${gameState.path.name} becomes a supreme power under your guidance. Empires bow to you.\n\n[EPIC ENDING: Ascended Immortal]`,
                    
                    `The Emerald Truth became your very essence:\n\n"The dao flows through my veins as jade qi."\n\nYou conquered seven rival sects, unified them under your banner, and created an empire of cultivation. Your descendants rule for ten thousand years.\n\n[EPIC ENDING: Cultivation Emperor]`
                ],
                
                gold: [
                    `After ${gameState.maxTurns} trials with your LEGENDARY ${gameState.selectedTalent.name}, you didn't just understand the Emerald Truth - YOU REWROTE IT:\n\n"I do not follow the dao. THE DAO FOLLOWS ME."\n\nYou shattered the heavenly tribulation, broke through to the Sovereign realm, and ascended beyond the mortal plane. The ${gameState.path.name} becomes the supreme authority of ten thousand realms.\n\nYour name is eternal. Cultivators in a million years will still chant your scriptures.\n\n[LEGENDARY ENDING: Immortal Sovereign - PERFECT CULTIVATION]`,
                    
                    `The LEGENDARY ${gameState.selectedTalent.name} allowed you to achieve the impossible:\n\n"Heaven and Earth bow. Time and Space yield. I am beyond."\n\nYou became a True Immortal, rewrote the laws of cultivation itself, and your jade qi infused the entire world. Every cultivator after you is touched by your legacy.\n\nYour existence transcends history.\n\n[LEGENDARY ENDING: World-Shaper - THE DAO ITSELF]`,
                    
                    `With ${gameState.selectedTalent.name}, you achieved what none before could:\n\n"The Emerald Truth is simple: I am inevitable."\n\nYou didn't just master cultivation - you BECAME it. Your consciousness merged with the heavenly dao. You exist everywhere jade exists, forever.\n\nYou are deathless. You are eternal. You are GOD.\n\n[LEGENDARY ENDING: Eternal Jade God - APOTHEOSIS COMPLETE]`
                ]
            };
            
            const rarity = gameState.selectedTalent.rarity;
            const endingList = endings[rarity];
            const ending = endingList[Math.floor(Math.random() * endingList.length)];
            
            storyText.textContent = ending;
            
            choicesContainer.innerHTML = '';
            const restartBtn = document.createElement('button');
            restartBtn.textContent = '> Begin New Life (Reincarnate)';
            restartBtn.onclick = () => location.reload();
            choicesContainer.appendChild(restartBtn);
        }

        // start
        const startBtn = document.createElement('button');
        startBtn.textContent = '> Enter Cultivation World';
        startBtn.onclick = () => {
            choicesContainer.innerHTML = '';
            initCamera();
        };
        choicesContainer.appendChild(startBtn);
        
        status.textContent = 'Ready';
    </script>
</body>
</html>
--->